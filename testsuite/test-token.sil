define_function stmt_cb(fsn, stmt) {
    if (not stmt_is_call(stmt)) {
        return;
    }

    callee = op_name(stmt_call_fn(stmt));
    if (callee == "memcpy" or callee == "strncpy") {
        arg0 = stmt_arg(stmt, 0);
        arg1 = stmt_arg(stmt, 1);
        arg2 = stmt_arg(stmt, 2);
        if (op_memsz(arg0) < op_value(arg2)) {
            warn("OOBW", stmt);
        } else if (op_memsz(arg1) < op_value(arg2)) {
            warn("OOBR", stmt);
        }
    } else if (callee == "strcpy") {
        arg0 = stmt_arg(stmt, 0);
        arg1 = stmt_arg(stmt, 1);
        if (op_memsz(arg0) < op_memsz(arg1)) {
            warn("OOBW", stmt);
        }
    }
}

define_function fsn_cb(fsn) {
    for_each_stmt_fsn(stmt, fsn, stmt_cb);
}

define_function main() {
    for_each_fsn(fsn, fsn_cb);
}
